name: CI

# ⚠️ DEVELOPMENT STATUS: Pre-v1.0 - Tests may be incomplete
# This workflow validates basic functionality during active development

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]
      fail-fast: false  # Continue testing even if one OS fails
    steps:
    - uses: actions/checkout@v4
    - name: Setup Node.js 20
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    - name: Install dependencies (if package.json present)
      # Run install with the shell appropriate for the runner
      # Linux install
      if: matrix.os == 'ubuntu-latest'
      run: |
        if [ -f package.json ]; then npm ci; fi

    - name: Install dependencies (Windows)
      if: matrix.os == 'windows-latest'
      shell: pwsh
      run: |
        if (Test-Path -Path package.json) { npm ci }

    - name: Validate Node.js setup
      run: node --version

    - name: Check package.json structure
      run: node -e "const pkg = require('./package.json'); console.log('✓ Package:', pkg.name, pkg.version);"

    - name: Run tests (Linux)
      if: matrix.os == 'ubuntu-latest'
      continue-on-error: true  # Pre-v1.0: Don't fail CI on test errors
      run: |
        if [ -f package.json ]; then
          npm test || echo "⚠️ Tests failed (expected in development)"
        fi

    - name: Run tests (Windows)
      if: matrix.os == 'windows-latest'
      continue-on-error: true  # Pre-v1.0: Don't fail CI on test errors
      shell: pwsh
      run: |
        if (Test-Path -Path package.json) {
          npm test
          if ($LASTEXITCODE -ne 0) {
            Write-Host "⚠️ Tests failed (expected in development)" -ForegroundColor Yellow
          }
        }
